/**
 *    jquery.msgbox 6.1 - 2011-05-05
 *
 *  Author: pwwang
 *  Website: http://pwwang.com
 *  Note: All the stuff written by pwwang
 *        Feel free to do whatever you want with this file
 *        Please keep the distribution
 *
 **/
(function($){var $msgbox=function(o){if(typeof(o)=='string'){o={content:{type:'text',content:o}}}
opts=o||{};opts.width=o.width||360;opts.height=o.height||200,opts.autoClose=o.autoClose||0;opts.title=o.title||'提示',opts.wrapperClass=o.wrapperClass||'msgbox_wrapper';opts.titleClass=o.titleClass||'msgbox_title';opts.closeClass=o.closeClass||'msgbox_close';opts.titleWrapperClass=o.titleWrapperClass||'msgbox_title_wrapper';opts.mainClass=o.mainClass||'msgbox_main';opts.bgClass=o.bgClass||'msgbox_bg';opts.buttonClass=o.buttonClass||'msgbox_button';opts.inputboxClass=o.inputboxClass||'msgbox_inputbox';opts.content=typeof o.content=='string'?{type:'text',content:o.content}:(o.content||{type:'text',content:''});opts.content.type=o.content.type||'text';opts.content.content=o.content.content||'';opts.onClose=o.onClose||function(){};opts.closeIcon=typeof o.closeIcon=='string'?{type:'string',content:o.closeIcon}:(o.closeIcon||{type:'string',content:'×'});opts.closeIcon.type=o.closeIcon.type||'string';opts.closeIcon.content=o.closeIcon.content||'×';opts.closeIcon.content=opts.closeIcon.type=='icon'?'<img src="'+opts.closeIcon.content+'" border="0" />':opts.closeIcon.content;opts.bgOpacity=o.bgOpacity||0.6;opts.onAjaxed=o.onAjaxed||function(){};opts.onInputed=o.onInputed||function(){};opts.drag=typeof o.drag!='boolean'?true:o.drag;opts.animation=typeof o.animation!='number'?1:o.animation;opts.showClose=typeof o.showClose=='undefined'?true:o.showClose;var returnValue=false;var relTop=0;var relLeft=0;var $background=$("<div>").css({'position':'absolute','width':$(window).width(),'height':$(window).height(),'z-index':'9999','opacity':'0','top':'0','left':'0'}).addClass(opts.bgClass).click(function(){flashTitle(0.5,4,80);});var $wrapper=$("<div>").css({'width':opts.width+'px','height':opts.height+'px','position':'absolute','z-index':'10000','display':'none'}).addClass(opts.wrapperClass)
var $titleWrapper=$('<ul><li>提示</li><li>Close</li></ul>').addClass(opts.titleWrapperClass).appendTo($wrapper);var $titleLi=$("li:first",$titleWrapper).html(opts.title).addClass(opts.titleClass);var $closeLi=$titleLi.next().addClass(opts.closeClass);if(opts.showClose){$closeLi.html(opts.closeIcon.content).mousedown(closeMe);}else{$closeLi.html('');}
var $main=$("<div />").addClass(opts.mainClass).appendTo($wrapper);relLeft=($(window).width()-opts.width)/2;relTop=($(window).height()-opts.height)/2;function animation(act,t,fn){switch(t){case 1:if(act=='open'){$background.animate({'opacity':opts.bgOpacity},function(){$wrapper.slideDown('fast');});}else{$wrapper.slideUp('fast',function(){$background.fadeOut('fast');});}
break;case 2:if(act=='open'){$background.animate({'opacity':opts.bgOpacity},function(){$wrapper.animate({'width':'toggle'},'fast','swing');});}else{$wrapper.animate({'width':'toggle'},'fast','swing',function(){$background.fadeOut('fast');});}
break;case 3:if(act=='open'){$background.animate({'opacity':opts.bgOpacity},function(){$wrapper.animate({'width':'toggle','height':'toggle'},'fast','swing');});}else{$wrapper.animate({'width':'toggle','height':'toggle'},'fast','swing',function(){$background.fadeOut('fast');});}
break;default:if(act=='open'){$background.css('opacity',opts.bgOpacity);$wrapper.css('display','');}else{$background.remove();$wrapper.remove();}}}
function closeMe(){opts.onClose(returnValue);animation('close',opts.animation);}
function isVisible(){return $background.is(":visible")&&$wrapper.is(":visible");}
function autoCloseMe(autoClose){if(autoClose>0&&isVisible()){autoCloseStr="<font>Auto-closed after "+autoClose+"s ...</font>";$titleLi.html(opts.title+" &nbsp; "+autoCloseStr);autoClose--;if(autoClose==0)
closeMe();setTimeout(function(){autoCloseMe(autoClose)},1000);}}
function resetPosition(){$background.css({'width':$(window).width()+'px','height':$(window).height()+'px'}).offset({left:$(window).scrollLeft(),top:$(window).scrollTop()});fixBox();}
function flashTitle(opacity,times,interval,flag){if(times>0){flag=!flag;op=flag?opacity:1;$titleWrapper.css('opacity',op);setTimeout(function(){flashTitle(opacity,times-1,interval,flag)},interval);}}
function fixBox(){$wrapper.css({'top':$(window).scrollTop()+relTop+'px','left':$(window).scrollLeft()+relLeft+'px'});}
function msgbox(ctt){switch(ctt.type){case'input':$main.html("<p>"+ctt.content+"</p>");var $inputbox=$("<input type='text' />").appendTo($main).addClass(opts.inputboxClass);var $buttonWrapper=$("<div>").css({'text-align':'center','padding':'15px 0'}).appendTo($main);var $yesButton=$("<input type=button value=' OK '>").appendTo($buttonWrapper).addClass(opts.buttonClass).after(" &nbsp; &nbsp; ").click(function(){opts.onInputed($inputbox.val());closeMe();});var $noButton=$("<input type=button value=' Cancel '>").appendTo($buttonWrapper).addClass(opts.buttonClass).click(closeMe);break;case'alert':$main.html("<p>"+ctt.content+"</p>");var $buttonWrapper=$("<div>").css({'text-align':'center','padding':'15px 0'}).appendTo($main);var $OKButton=$("<input type=button value=' OK '>").appendTo($buttonWrapper).addClass(opts.buttonClass).click(closeMe);break;case'confirm':$main.html("<p>"+ctt.content+"</p>");var $buttonWrapper=$("<div>").css({'text-align':'center','padding':'15px 0'}).appendTo($main);var $yesButton=$("<input type=button value=' Yes '>").appendTo($buttonWrapper).addClass(opts.buttonClass).after(" &nbsp; &nbsp; ").click(function(){returnValue=true;closeMe();});var $noButton=$("<input type=button value=' No '>").appendTo($buttonWrapper).addClass(opts.buttonClass).click(function(){returnValue=false;closeMe();});break;case'get':case'ajax':case'url':$main.html("Loading ...").load(ctt.content,function(data){(opts.onAjaxed)(data);});break;case'iframe':$('<iframe frameborder="0" marginheight="0" marginwidth="0" scrolling="auto"></iframe>').appendTo($main).attr({'width':'100%','height':'100%','src':ctt.content});break;default:$main.html(ctt.content);}}
function allowDrag(flag){if(flag)
$wrapper.Drags({handler:$titleWrapper,range:'window',onDrop:function(){relTop=$wrapper.getCss('top')-$(window).scrollTop();relLeft=$wrapper.getCss('left')-$(window).scrollLeft();}});}
function showMe(){$('body').append($background).append($wrapper);msgbox(opts.content);$main.css('height',opts.height-$titleWrapper.outerHeight(true)-$main.getCss('padding-top')-$main.getCss('padding-bottom'));animation('open',opts.animation);resetPosition();fixBox();$(window).load(resetPosition).resize(resetPosition).scroll(resetPosition);if(opts.autoClose>0)
autoCloseMe(opts.autoClose);allowDrag(opts.drag);}
showMe();this.value=returnValue;this.close=closeMe;this.setAutoClose=function(v){opts.autoClose=v;autoCloseMe(v);return this;}
this.setHeight=function(v){opts.height=v;$wrapper.css('height',v+'px');return this;}
this.setWidth=function(v){opts.width=v;$wrapper.css('width',v+'px');return this;}
this.setTitle=function(v){opts.title=v;$titleLi.html(v);return this;}
this.setWrapperClass=function(v){opts.wrapperClass=v;$wrapper.removeClass().addClass(v);return this;}
this.setTitleClass=function(v){opts.titleClass=v;$titleLi.removeClass().addClass(v);return this;}
this.setCloseClass=function(v){opts.closeClass=v;$closeLi.removeClass().addClass(v);return this;}
this.setTitleWrapperClass=function(v){opts.titleWrapperClass=v;$titleWrapper.removeClass().addClass(v);return this;}
this.setMainClass=function(v){opts.mainClass=v;$main.removeClass().addClass(v);return this;}
this.setBgClass=function(v){opts.bgClass=v;$background.removeClass().addClass(v);return this;}
this.setButtonClass=function(v){opts.buttonClass=v;$(":input(input[type=button], input[type=submit], input[type=reset])",$main).removeClass().addClass(v);return this;}
this.setInputboxClass=function(v){opts.inputboxClass=v;$("input[type=text]",$main).removeClass().addClass(v);return this;}
this.setContent=function(v){v=typeof v=='string'?{type:'text',content:v}:v;v.type=v.type||'text';v.content=v.content||opts.content.content||'';opts.content=v;msgbox(v);return this;}
this.setBgOpacity=function(v){opts.bgOpacity=v;$background.css('opacity',v);return this;}
this.setOnClose=function(v){opts.onClose=v;return this;}
this.setOnAjaxed=function(v){opts.onAjaxed=v;return this;}
this.setOnInputed=function(v){opts.onInputed=v;return this;}
this.setAnimation=function(v){opts.animation=v;return this;}
this.setCloseIcon=function(v){v=typeof v=='string'?{type:'string',content:v}:v;v.type=v.type||'string';v.content=v.content||'×';v.content=v.type=='icon'?'<img src="'+v.content+'" border="0" />':v.content;opts.closeIcon=v;$closeLi.html(v.content);return this;}
this.setShowClose=function(v){if(v){$closeLi.html(opts.closeIcon.content).mousedown(closeMe);}else{$closeLi.html('').unbind('mousedown');}
return this;}}
$.msgbox=function(o){return new $msgbox(o);}})(jQuery);
